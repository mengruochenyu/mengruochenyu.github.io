<!DOCTYPE html>
<html>

<head>
	<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
	<meta charset="UTF-8">
	<title>注册</title>
	<link rel="stylesheet" type="text/css" href="css/picker.css" />
	<link rel="stylesheet" type="text/css" href="css/zhuceDetail.css" />
	<link rel="stylesheet" type="text/css" href="css/iosSelect.css" />
	<link rel="stylesheet" href="css/LArea.css">
</head>

<body>
	<div style="width: 100%;background: #3C3B40;">
		<div class="top">注册</div>
	</div>
	<!--头像-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">头像</div>
			<div style="text-align: right;"><img src="img/youjian.png" style="margin-top: 17px;" alt="" /></div>
			<img src="img/touxiang.jpg" alt="" class="img" id="showImg" />
			<input accept="image/*" type="file" id="uploadIMG" onchange="btnUploadFile(event)" style="display: none" />
		</div>
	</div>
	<!--账号-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">账号/手机号</div>
			<div style="text-align: right;" id="mobile"></div>
		</div>
	</div>
	<!--编号-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">编号</div>
			<div style="text-align: right;" id="number"></div>
		</div>
	</div>
	<!---->
	<div class="fen"></div>
	<!--姓名-->
	<div class="touxiang">
		<div class="content">
			<div class="xinghao">*</div>
			<div style="text-align: left;">姓名</div>
			<div style="text-align: right;">
				<input type="text" name="txt" class="txt" id="txt" value="" placeholder="请输入姓名必填" />
			</div>
		</div>
	</div>
	<!--性别-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">性别</div>
			<div style="text-align: right;">
				<input type="text" name="txt" class="txt" id="txt1" value="" placeholder="男" />
			</div>
		</div>
	</div>
	<!--城市-->
	<div class="touxiang">
		<div class="content">

			<div style="text-align: left;">城市</div>
			<div style="text-align: right;">
				<input type="text" name="txt" id="txt2" class="txt" value="" placeholder="请选择城市" />
			</div>
		</div>
	</div>
	<!--生日-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">生日</div>
			<div style="text-align: right;">
				<input type="text" name="txt" id="txt3" class="txt" value="" placeholder="请选择出生年月" />
			</div>
		</div>
	</div>
	<!--文化-->
	<div class="touxiang">
		<div class="content">

			<div style="text-align: left;">文化</div>
			<div style="text-align: right;">
				<input type="text" name="txt" id="txt4" class="txt" value="" placeholder="请选择文化程度" />
			</div>
		</div>
	</div>
	<!--职业-->
	<div class="touxiang">
		<div class="content">

			<div style="text-align: left;">职业</div>
			<div style="text-align: right;">
				<input type="text" name="txt" id="txt5" class="txt" value="" placeholder="请输入职业" />
			</div>
		</div>
	</div>
	<!--婚姻-->
	<div class="touxiang">
		<div class="content">
			<div style="text-align: left;">婚姻</div>
			<div style="text-align: right;">
				<input type="text" name="txt" id="txt6" class="txt" value="" placeholder="请选择婚姻状态" />
			</div>
		</div>
	</div>
	<!--确定按钮-->
	<div class="button">确定</div>
	<!--性别遮罩层-->
	<div class="zhezhao">
		<div class="zhe1">
			<div class="zhe11"><span>女</span><img src="img/nv.png" alt="" class="img11" /></div>
			<div class="zhe12"></div>
			<div class="zhe13"><span>男</span><img src="img/nan.png" alt="" class="img11" /></div>
		</div>
		<div class="zhe2">取消</div>
	</div>
</body>
<script src="js/LAreaData1.js"></script>
<script src="js/LAreaData2.js"></script>
<script src="js/LArea.js"></script>
<script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
<script src="js/datePicker.min.js" type="text/javascript" charset="utf-8"></script>
<script src="js/main.js"></script>
<script src="js/html.js" type="text/javascript" charset="utf-8"></script>
<script src="js/iosSelect.js" type="text/javascript" charset="utf-8"></script>
<script type="text/javascript">
	//确定按钮
	var txt = document.getElementById('txt');
	var btn = document.getElementsByClassName("button")[0];
	txt.oninput = function() {
		if (txt.value != "") {
			btn.style.background = "#40B7AF";
			btn.style.color = "#ffffff";
		} else {
			btn.style.background = "#EBEBEB";
			btn.style.color = "#AAAAAA";
		}
	}
	//性别
	var zhe11 = document.getElementsByClassName("zhe11")[0];
	var zhe13 = document.getElementsByClassName("zhe13")[0];
	var zhe2 = document.getElementsByClassName("zhe2")[0];
	var zhezhao = document.getElementsByClassName("zhezhao")[0];
	var txt1 = document.getElementById('txt1');
	txt1.onclick = function() {
		zhezhao.style.display = "block";
	}
	zhe2.onclick = function() {
		zhezhao.style.display = "none";
	}
	zhe13.onclick = function() {
		zhezhao.style.display = "none";
		txt1.value = "男";
	}
	zhe11.onclick = function() {
		zhezhao.style.display = "none";
		txt1.value = "女";
	}
	//文化
	var showBankDom = document.querySelector('#txt4');
	//  var bankIdDom = document.querySelector('#bankId');
	showBankDom.addEventListener('click', function() {
		var bankId = showBankDom.dataset['id'];
		var bankName = showBankDom.dataset['value'];

		var bankSelect = new IosSelect(1,
			[data], {
				container: '.container',
				itemHeight: 50,
				itemShowCount: 3,
				oneLevelId: bankId,
				callback: function(selectOneObj) {
					showBankDom.value = selectOneObj.value;
				}
			});
	});
	//婚姻
	var showBankDom1 = document.querySelector('#txt6');
	//  var bankIdDom = document.querySelector('#bankId');
	showBankDom1.addEventListener('click', function() {
		var bankId = showBankDom.dataset['id'];
		var bankName = showBankDom.dataset['value'];

		var bankSelect = new IosSelect(1,
			[data1], {
				container: '.container',
				itemHeight: 50,
				itemShowCount: 3,
				oneLevelId: bankId,
				callback: function(selectOneObj) {
					showBankDom1.value = selectOneObj.value;
				}
			});
	});
	//选择城市
	var txt2 = document.getElementById("txt2");
	var area1 = new LArea();
	area1.init({
		'trigger': '#txt2', //触发选择控件的文本框，同时选择完毕后name属性输出到该位置
		//'valueTo': '#txt2', //选择完毕后id属性输出到该位置
		'keys': {
			id: 'id',
			name: 'name'
		}, //绑定数据源相关字段 id对应valueTo的value属性输出 name对应trigger的value属性输出
		'type': 1, //数据源类型
		'data': LAreaData //数据源
	});
	//选择时间
	var nowValue1 = document.getElementById('txt3');
	nowValue1.onclick = function() {
		demoClick();
	}

	function demoClick() {
		var nowValue = document.getElementById('txt3');
		new DatePicker({
			"type": "3", //0年, 1年月, 2月日, 3年月日
			//"title": '请选择日期',//标题(可选)
			"maxYear": "", //最大年份（可选）
			"minYear": "", //最小年份（可选）
			//"separator": "-",//分割符(可选)
			"defaultValue": nowValue.value, //默认值（可选）
			"callBack": function(val) {
				//回调函数（val为选中的日期）
				nowValue.value = val;
			}
		});
	}
</script>

<script type="text/javascript">
	//点击头像图片触发的事件：
	$("#showImg").click(function() {
		//拉起图片选择
		$("#uploadIMG").click();
	});

	function btnUploadFile(e) {
		var imgFile = e.target.files[0]; //获取图片文件
		//后缀选取
		if (!/\/(?:jpeg|jpg|png)/i.test(imgFile.type)) {
			console.log(图片格式不支持);
			return;
		}
		var reader = new FileReader();
		reader.onload = function(evt) {
			$("#showImg").attr("src", evt.target.result);
		}
		reader.readAsDataURL(imgFile);
	}

	function handleChange(event) {
		var data = window.event || event;
		handleInputChange(data);
	}
	//获取参数并显示
	var url = getURL();
	$("#mobile").html(url.mobile);
	$("#number").html(url.number);
	//确定按钮的点击事件
	btn.onclick = function() {
		if (txt.value == "" || txt.value == null) {
			return false;
		}
		//需要获取的文本的id:
		var name = $("#txt").val(); //姓名
		var gender = $("#txt1").val() == '男' ? 1 : 2; //性别
		var address = $("#txt2").val(); //城市
		var birthday = $("#txt3").val().replace("/", "-").replace("/", "-"); //生日
		var degree = $("#txt4").val(); //文化
		var career = $("#txt5").val(); //职业
		var maritalStatus = $("#txt6").val(); //婚姻
		var addressProv = null;
		var addressCity = null
		var addressCounty = null;
		if (address != null && address != "") {
			var addressList = address.split(','); //地址的处理
			var addressProv = addressList[0];
			var addressCity = addressList[1];
			var addressCounty = addressList[2];
		}
		if (maritalStatus == "已婚") { //数据转换
			maritalStatus = 1;
		} else if (maritalStatus == "未婚") {
			maritalStatus = 0;
		} else if (maritalStatus == "离异") {
			maritalStatus = 2;
		}
		//构建传输载体：
		var formData = new FormData();
		formData.append("name", name);
		formData.append("gender", gender);
		formData.append("address", address);
		formData.append("birthday", birthday);
		formData.append("degree", degree);
		formData.append("career", career);
		if (addressProv != null) {
			formData.append("addressProv", addressProv);
		}
		if (addressCity != null) {
			formData.append("addressCity", addressCity);
		}
		if (addressCounty != null) {
			formData.append("addressCounty", addressCounty);
		}
		formData.append("maritalStatus", maritalStatus);
		formData.append("photoUrl", $("#showImg").attr("src"));
		formData.append("imageFile", document.getElementById('uploadIMG').files[0]);
		//POST
		$.ajax({
			url: config.url + "member/update?token=" + url.token,
			async: false,
			type: "POST",
			data: formData,
			dataType: "json",
			processData: false,
			contentType: false,
			success: function(data) {
				var code = data.code;
				console.log(code);
				if (code == 200) {
					window.location.href = 'xiazai.html';
				} else if (code == 402 || code == 407) {
					console.log("参数存在异常");
				} else if (code == 409 || code == 410) {
					jump(config.login);
					delAllCookies();
				} else {
					//fail(data);
					console.log(code);
				}
			},
			error: function(xhr) {
				if (error) {

				} else {
					Alert("网络不稳定，稍后再试！");
				}
			}
		});
	}
</script>

</html>
